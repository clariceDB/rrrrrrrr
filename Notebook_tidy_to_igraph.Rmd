---
title: "R Notebook"
output: html_notebook
---

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code. 

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Cmd+Shift+Enter*. 
```{r Load}
pacman::p_load(randomNames, tidygraph, tidyverse, igraph, ggraph, ggplot)
setwd(getwd())
options(scipen = 999)
```

```{r Read in}
some_names = randomNames(144, which.names="first")

enron <- read_delim("dataraw/email-enron-only.mtx",delim = " ",col_names = F) %>% 
  rename("from" = X1,
         "to" = X2) %>% 
  mutate(triads_g = "default") %>% 
  mutate(name = "default") %>%
  graph_from_data_frame()

V(enron)$name <- some_names
```
```{r}
typeof(enron)
E(enron)
  NULL
```

```{r}
enron_tidy <- as_tbl_graph(enron)
```


```{r}
enron_tidy %>% 
  ggraph()+
  geom_node_point() + 
  geom_node_text(aes(label = V(enron)$name), repel = F) +
  geom_edge_diagonal()+
  theme_graph()
```


Triad Cenus is not a measurement available in Tidygraph. Beware the return! (16 vectors)
```{r Triad}
tri_result <- igraph::triad_census(enron_tidy)
tri_result
```

```{r}
enron %>% as_tbl_graph() %>% class()
enron %>% 
  as_tbl_graph() %>% 
  triad_census()
```

```{r}
triad_names<- c("003 ","012 ","102 ","021D","021U","021C","111D","111U","030T","030C","201 ","120D","120U","120C","210 ","300 ")

new_df <- enron %>%
  as_tbl_graph() %>%
  mutate(triads_g = list(triad_census(.G()))) 

one <- V(new_df)$triads_g
```

```{r}
enron %>% 
as_data_frame() %>% 
  select(triads_g,name) %>% 
  unnest() %>% 
  mutate(triad = rep(triad_names, 39)) %>% 
  distinct(triads_g,triad)
```

```{r}
one[[1]]
new_df <- data.frame(values = one[[1]], names = triad_names)
```

```{r}

 ggplot(new_df) +
  geom_bar(aes(x=names, y=values), stat="identity") +
  scale_y_log10() +
  ggtitle("Triad Census") +
  xlab("Triad type") +
  ylab("Count")
  
```

